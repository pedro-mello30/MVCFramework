<?php
/**
 *
 *
 *                                              ........................
 *                                           .....',;,,;;;;;,,''...........
 *                                         ..'..........'',;;;;,'........''..
 *                                        .'..................,,,,'.......';,.
 *                                      .''..'''.','..''........',;,,'.....';;'.
 *                                     .,,';;;;;,;;;;;;;;,''......';;'......,;;'.
 *                                   .,;:;;;,''..'...''',,,,,,'.....;;,'.....;;'''.
 *                                 .':;;,.'.....'.'''''......',,,...',;,.....,;,..'.
 *                                .;:'''....'',;;;,'......     ..''..';;'....';,'...'.
 *                               .','....'',;;;,'..              .....';,'...';,.'...'.
 *                              .'.'..'.';:;,'....                  ..';,....';,'..'..'.
 *                              '' .'.',:;,..''..                     .,'....,;''...'.'.
 *                              .'..'';:;'..','.                      .''...,;,..'..',,.
 *                              .'..,,c;...';;.                       .'...';,....'.':,.
 *                               .'.,c;...',:,.                       ....';,'....',;:.
 *                               .',;c,...':;...                      ..',,,......,:;,.
 *                                .;c;....,:;..'.                    .',,,'.....,,:,,.
 *                                .;c;....,:;..',.                 ..',''.....';;;'''.
 *                                 ,c,....,:;...,;'...          ..........'',;;,,'.'.
 *                                 .:;...'';:,...,;,..................',,,;,,,..'..'.
 *                                  ';'...',::'..',;;,...'''',,,,,,,,,;,,,'''..'. ''
 *                                  .'....'',::...'',;;,'......''..''......'..'...'.
 *                                   ..'....';::'....',;;;,''................,,.'..
 *                                     .....'',:c;'......',,;;,;;;,,,,,,;;;;;'...
 *                                         ....';c:,..........',;;;,,;:;;,'..
 *                                             ...';:;'...........''....
 *                                                  .',,,,..........
 *                                                      ........
 *
 * Copyright (c) 2019 Pedro Mello.
 *
 */

class Core
{
    public $route;

    function __construct()
    {
        $this->route = new Router(new Request());
    }

    public function getRoute() : Router
    {
        return $this->route;
    }

    function start()
    {
        $controller = $this->route->getController();
        $action = $this->route->getAction();
        $params = $this->route->getParameters();
        $controller_path = CONTROLLERS .  $controller . "Controller.php";

        if ( !file_exists( $controller_path ) )
        {
            new ErrorHelper('controller');
        }

        require_once( $controller_path );
        $app = new $controller();

        if (!method_exists($app, $action))
        {
            new ErrorHelper('action');
        }

        if(empty($params))
        {
            $app->init();
            $app->$action();
        }
        else
        {
            $i = 0;

            $valores = array();

            foreach ($params as $p)
            {
                $valores[$i] = $p;
                $i++;
            }
            $app->init($valores);
            $app->$action($valores);

        }
    }
}



?>